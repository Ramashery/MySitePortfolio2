name: ğŸš€ Auto Deploy to Netlify

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch: # ĞŸĞ¾Ğ·Ğ²Ğ¾Ğ»ÑĞµÑ‚ Ğ·Ğ°Ğ¿ÑƒÑĞºĞ°Ñ‚ÑŒ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ” Check file changes
      id: check-changes
      run: |
        echo "Checking for changes in key files..."
        if git diff --name-only ${{ github.event.before }} ${{ github.sha }} | grep -E '\.(html|js|css|xml|txt)$'; then
          echo "has_changes=true" >> $GITHUB_OUTPUT
          echo "âœ… Changes detected in website files"
        else
          echo "has_changes=false" >> $GITHUB_OUTPUT
          echo "â„¹ï¸ No website file changes detected"
        fi
        
    - name: ğŸš€ Deploy to Netlify
      if: steps.check-changes.outputs.has_changes == 'true'
      uses: nwtgck/actions-netlify@v2.0
      with:
        publish-dir: '.'
        production-branch: main
        github-token: ${{ secrets.GITHUB_TOKEN }}
        deploy-message: "ğŸš€ Auto-deploy from GitHub Actions - ${{ github.event.head_commit.message }}"
        enable-pull-request-comment: true
        enable-commit-comment: true
        
    - name: ğŸ“± Send notification
      if: steps.check-changes.outputs.has_changes == 'true'
      run: |
        echo "ğŸ“± Deployment notification sent!"
        echo "ğŸŒ Site will be updated in 2-5 minutes"
        echo "ğŸ”— Check status at: ${{ env.NETLIFY_URL }}"
        
    - name: âœ… Deployment complete
      if: steps.check-changes.outputs.has_changes == 'true'
      run: |
        echo "ğŸ‰ Automatic deployment completed successfully!"
        echo "â° Deployment time: $(date)"
        echo "ğŸ“Š Files updated: ${{ github.event.head_commit.message }}"
        
    - name: â„¹ï¸ No changes
      if: steps.check-changes.outputs.has_changes == 'false'
      run: |
        echo "â„¹ï¸ No website files changed, skipping deployment"
        echo "ğŸ’¡ Only configuration files were updated"