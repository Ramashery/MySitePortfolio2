<!DOCTYPE html>
<html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Web Development &amp; SEO Services in Tbilisi, Georgia | Digital Craft</title>
    <meta name="description" content="Professional web development and SEO services based in Tbilisi. We build high-performance websites for businesses.">
    
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>

    <style>
        :root { --color-bg: #030409; --color-text: #FFFFFF; --color-accent: #b8d8e8; }
        body { margin: 0; padding: 0; background-color: var(--color-bg); color: var(--color-text); font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; overflow-x: hidden; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--color-bg); display: flex; justify-content: center; align-items: center; z-index: 10000; transition: opacity 0.5s ease-out; }
        #loader.hidden { opacity: 0; pointer-events: none; }
        .spinner { width: 50px; height: 50px; border: 3px solid var(--color-accent); border-radius: 50%; border-top-color: transparent; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
    <link rel="stylesheet" href="/styles.css" media="print" onload="this.media='all'">
    <noscript><link rel="stylesheet" href="/styles.css"></noscript>
</head>
<body>
    <noscript>
        <div><img src="https://mc.yandex.ru/watch/103413242" style="position:absolute; left:-9999px;" alt=""></div>
        <h1>Digital Craft - Web Development &amp; SEO in Tbilisi</h1>
        <p>We create professional, high-performance websites and provide SEO services.</p>
    </noscript>

    <div id="loader"><div class="spinner"></div></div>
    <iframe id="custom-background-iframe" title="Custom Background"></iframe>
    <button class="menu-toggle" aria-label="Toggle menu"><span class="bar"></span><span class="bar"></span><span class="bar"></span></button>
    <div class="nav-overlay"><ul class="nav-menu"></ul></div>

    <main>
        <!-- СТАТИЧЕСКАЯ ЗАГЛУШКА ДЛЯ GOOGLE BOT -->
        <section id="hero"><h1>Loading Content...</h1></section>
        <section id="services"><h2>Our Services</h2></section>
        <section id="portfolio"><h2>Our Work</h2></section>
        <section id="blog"><h2>Latest Insights</h2></section>
        <section id="contact"><h2>Get in Touch</h2></section>
    </main>
    
    <footer class="site-footer" id="site-footer"></footer>
    
    <script type="module">
        // --- CONFIG & STATE ---
        const firebaseConfig = {
          apiKey: "AIzaSyAT4dDEIDUtzP60ibjahO06P75Q6h95ZN4",
          authDomain: "razrabotka-b61bc.firebaseapp.com",
          projectId: "razrabotka-b61bc",
          storageBucket: "razrabotka-b61bc.firebasestorage.app",
          messagingSenderId: "394402564794",
          appId: "1:394402564794:web:f610ffb03e655c600c5083"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        db.enablePersistence().catch(err => console.error("Firestore persistence error: ", err));

        let siteData = {};
        const defaultLang = 'en';

        // --- DATA HELPERS ---
        const processDocData = (data) => {
            if (data && typeof data.schemaJsonLd === 'string' && data.schemaJsonLd.trim().startsWith('{')) {
                try { data.schemaJsonLd = JSON.parse(data.schemaJsonLd); } 
                catch (e) { console.error('Failed to parse schemaJsonLd string:', e); data.schemaJsonLd = {}; }
            }
            return data;
        };
        async function loadData() {
            try {
                const collections = ['services', 'portfolio', 'blog', 'contact'];
                const promises = [
                    db.collection('home').doc('content').get(),
                    ...collections.map(col => db.collection(col).get())
                ];
                const [homeDoc, ...snapshots] = await Promise.all(promises);
                const freshData = {};
                freshData.home = homeDoc.exists ? processDocData(homeDoc.data()) : {};
                collections.forEach((col, i) => {
                    freshData[col] = snapshots[i].docs.map(doc => ({ id: doc.id, ...processDocData(doc.data()) }));
                });
                return freshData;
            } catch (error) {
                console.error("Fatal Error: Could not load data from Firebase.", error);
                return null;
            }
        }

        // --- SEO & METADATA ---
        function renderSeoTags(data) {
            if (!data) return;
            document.querySelectorAll('meta[name="description"], meta[property^="og:"], script[type="application/ld+json"], link[rel="canonical"]').forEach(el => el.remove());
            document.title = data.seoTitle || "Digital Craft";
            document.documentElement.lang = data.lang || defaultLang;
            const createMeta = (attr, key, value) => { if (value) { const meta = document.createElement('meta'); meta.setAttribute(attr, key); meta.content = value; document.head.appendChild(meta); } };
            createMeta('name', 'description', data.metaDescription);
            const ogImage = data.ogImage || (Array.isArray(data.media) ? data.media.find(url => !/youtube|vimeo/.test(url)) : '') || '';
            createMeta('property', 'og:title', data.ogTitle || data.seoTitle);
            createMeta('property', 'og:description', data.ogDescription || data.metaDescription);
            if (ogImage) createMeta('property', 'og:image', ogImage);
            const canonical = document.createElement('link');
            canonical.rel = 'canonical';
            const canonicalBaseUrl = 'https://digital-craft-tbilisi.netlify.app';
            let cleanPath = window.location.pathname;
            if (cleanPath.length > 1 && cleanPath.endsWith('/')) { cleanPath = cleanPath.slice(0, -1); }
            canonical.href = canonicalBaseUrl + cleanPath;
            document.head.appendChild(canonical);
            if (data.schemaJsonLd && typeof data.schemaJsonLd === 'object' && Object.keys(data.schemaJsonLd).length > 0) {
                const script = document.createElement('script');
                script.type = 'application/ld+json';
                script.textContent = JSON.stringify(data.schemaJsonLd);
                document.head.appendChild(script);
            }
        }
        
        // --- CORE RENDER FUNCTIONS ---
        const mainContentEl = document.querySelector('main');
        let paragraphObserver, floatingObserver, homePageObserver;

        function formatContentHtml(content) { if (!content) return ''; let processedContent = content.replace(/\r\n/g, '\n'); return processedContent.split(/\n{2,}/).map(block => { const trimmedBlock = block.trim(); if (!trimmedBlock) return ''; const youtubeRegex = /^https?:\/\/(?:www\.|m\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch?v=|watch\?.*&v=|shorts\/))([a-zA-Z0-9_-]{11}).*$/; const imageRegex = /^https?:\/\/[^<>"']+\.(?:jpg|jpeg|png|gif|webp|svg)\s*$/i; const youtubeMatch = trimmedBlock.match(youtubeRegex); const imageMatch = trimmedBlock.match(imageRegex); if (/^<(p|div|h[1-6]|ul|ol|li|blockquote|hr|table|pre)/i.test(trimmedBlock)) return trimmedBlock; if (youtubeMatch && youtubeMatch[1]) return `<div class="embedded-video" style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000; margin: 1.5em 0; border-radius: 4px; border: 1px solid var(--color-border);"><iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;" src="https://www.youtube.com/embed/${youtubeMatch[1]}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div>`; if (imageMatch) return `<p style="margin: 1.5em 0;"><img src="${trimmedBlock}" alt="Embedded content" style="max-width: 100%; height: auto; display: block; margin: 0 auto; border-radius: 4px; border: 1px solid var(--color-border);" /></p>`; return `<p>${trimmedBlock.replace(/\n/g, '<br>')}</p>`; }).join(''); }

        function renderHomePage() {
            if (!siteData.home) { console.error("renderHomePage failed: siteData.home is missing."); return; }
            applyCustomBackground(siteData.home);
            renderSeoTags(siteData.home);
            renderHero(siteData.home);
            renderSection('services', 'Our Services', siteData.services);
            renderSection('portfolio', 'Our Work', siteData.portfolio);
            renderSection('blog', 'Latest Insights', siteData.blog);
            renderSection('contact', 'Get in Touch', siteData.contact);
            document.querySelector('#site-footer').style.display = 'block';
            initPageObservers();
            initMobileSliders();
        }

        function renderDetailPage(collection, slug, lang) {
            const item = siteData[collection]?.find(d => d.urlSlug === slug && d.lang === lang);
            if (!item) {
                mainContentEl.innerHTML = `<section class="detail-page-header"><h1>404 - Not Found</h1><p>The page you were looking for does not exist.</p><a href="/">Go back home</a></section>`;
                renderSeoTags({ seoTitle: "404 Not Found", lang: defaultLang });
                applyCustomBackground(siteData.home);
            } else {
                applyCustomBackground(item);
                renderSeoTags(item);
                const formattedContent = formatContentHtml(item.mainContent);
                mainContentEl.innerHTML = `<section><div class="detail-page-header"><h1 class="fade-in-up">${item.h1 || ''}</h1>${item.price ? `<div class="detail-price fade-in-up">${item.price}</div>` : ''}</div><div class="detail-content">${formattedContent}</div></section>`;
                renderRelatedPosts(item);
                initPageObservers();
            }
            document.querySelector('#site-footer').style.display = 'none';
        }
        
        // --- UI COMPONENT RENDERERS ---
        function renderMenu() { const menuItems = [ { label: 'Home', href: '/' }, { label: 'Services', href: '/#services' }, { label: 'Portfolio', href: '/#portfolio' }, { label: 'Blog', href: '/#blog' }, { label: 'Contact', href: '/#contact' } ]; document.querySelector('.nav-menu').innerHTML = menuItems.map(item => `<li><a href="${item.href}">${item.label}</a></li>`).join(''); }
        function renderHero(homeData) { const el = document.getElementById('hero'); if(el && homeData) { el.innerHTML = `<h1>${homeData.h1 || ''}</h1>${homeData.subtitle ? `<div class="hero-subtitle-container">${formatContentHtml(homeData.subtitle)}</div>` : ''}`; } }
        function renderSection(key, title, items) { const section = document.getElementById(key); if (!section) return; const itemsFromDb = items || []; const desktopItemsHTML = itemsFromDb.map(item => { const langPrefix = item.lang !== defaultLang ? `/${item.lang}` : ''; const itemUrl = `${langPrefix}/${key}/${item.urlSlug}`; return `<a href="${itemUrl}" class="item-card floating-item"><div class="item-card__image" style="background-image: url('${(item.media || []).find(url => !/youtube|vimeo/.test(url)) || ''}')"></div><div class="item-card__content"><h3>${item.title}</h3><div class="card-subtitle">${item.subtitle}</div><p>${item.description}</p></div></a>`; }).join(''); const desktopGrid = `<div class="item-grid">${desktopItemsHTML}</div>`; const langOrder = ['en', 'ka', 'ua', 'ru']; const itemsByLang = {}; itemsFromDb.forEach(item => { (itemsByLang[item.lang] = itemsByLang[item.lang] || []).push(item); }); const mobileSlidersHTML = langOrder.map(lang => { const langItems = itemsByLang[lang]; if (!langItems || langItems.length === 0) return ''; const slidesHTML = langItems.map((item, index) => { const langPrefix = item.lang !== defaultLang ? `/${item.lang}` : ''; const itemUrl = `${langPrefix}/${key}/${item.urlSlug}`; return `<a href="${itemUrl}" class="item-card ${index === 0 ? 'active' : ''}"><div class="item-card__image" style="background-image: url('${(item.media || []).find(url => !/youtube|vimeo/.test(url)) || ''}')"></div><div class="item-card__content"><h3>${item.title}</h3><div class="card-subtitle">${item.subtitle}</div><p>${item.description}</p></div></a>`; }).join(''); const dotsHTML = langItems.length > 1 ? langItems.map((_, index) => `<span class="slider-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></span>`).join('') : ''; return `<div class="language-slider-block"><div class="cross-fade-slider">${slidesHTML}</div><div class="slider-nav">${dotsHTML}</div></div>`; }).join(''); const mobileContainer = `<div class="mobile-sliders-container">${mobileSlidersHTML}</div>`; section.innerHTML = `<div class="animated-container"><h2>${title}</h2></div>${desktopGrid}${mobileContainer}`; }
        function renderRelatedPosts(currentItem) { const pool = (siteData.services || []).concat(siteData.blog || []); if (pool.length === 0) return; const relatedItems = pool.filter(item => item.lang === currentItem.lang && item.id !== currentItem.id).sort(() => 0.5 - Math.random()).slice(0, 3); if (relatedItems.length === 0) return; const itemsHTML = relatedItems.map(item => { const collection = item.price ? 'services' : 'blog'; const langPrefix = item.lang !== defaultLang ? `/${item.lang}` : ''; const itemUrl = `${langPrefix}/${collection}/${item.urlSlug}`; return `<a href="${itemUrl}" class="item-card floating-item"><div class="item-card__image" style="background-image: url('${(item.media || []).find(url => !/youtube|vimeo/.test(url)) || ''}')"></div><div class="item-card__content"><h3>${item.title}</h3><div class="card-subtitle">${item.subtitle}</div><p>${item.description}</p></div></a>`; }).join(''); const relatedSection = document.createElement('section'); relatedSection.id = 'related-posts'; relatedSection.innerHTML = `<h2 class="fade-in-up">You Might Also Like</h2><div class="item-grid">${itemsHTML}</div>`; mainContentEl.appendChild(relatedSection); }
        
        // --- UI & EVENT LISTENERS ---
        function initMobileSliders() { document.querySelectorAll('.language-slider-block').forEach(sliderBlock => { const slider = sliderBlock.querySelector('.cross-fade-slider'); if (!slider) return; const slides = slider.querySelectorAll('.item-card'); const nav = sliderBlock.querySelector('.slider-nav'); const dots = nav ? nav.querySelectorAll('.slider-dot') : []; if (slides.length <= 1) { if(slides[0]) slider.style.height = `${slides[0].offsetHeight}px`; return; } let currentIndex = 0; let autoSlideInterval; function goToSlide(index) { currentIndex = (index + slides.length) % slides.length; slides.forEach((s, i) => s.classList.toggle('active', i === currentIndex)); if (dots.length > 0) dots.forEach((d, i) => d.classList.toggle('active', i === currentIndex)); if (slides[currentIndex]) slider.style.height = `${slides[currentIndex].offsetHeight}px`; } function startAutoSlide() { stopAutoSlide(); autoSlideInterval = setInterval(() => goToSlide(currentIndex + 1), 5000); } function stopAutoSlide() { clearInterval(autoSlideInterval); } goToSlide(0); startAutoSlide(); if (nav) nav.addEventListener('click', e => { if (e.target.matches('.slider-dot')) { stopAutoSlide(); goToSlide(parseInt(e.target.dataset.index)); startAutoSlide(); } }); slider.addEventListener('touchstart', e => stopAutoSlide(), { passive: true }); slider.addEventListener('touchend', e => startAutoSlide(), { passive: true }); }); }
        function initPageObservers() { if (paragraphObserver) paragraphObserver.disconnect(); if (floatingObserver) floatingObserver.disconnect(); if (homePageObserver) homePageObserver.disconnect(); const createObserver = (options) => new IntersectionObserver((entries) => { entries.forEach(entry => { entry.target.classList.toggle('is-visible', entry.isIntersecting); }); }, options); floatingObserver = createObserver({ threshold: 0.1, rootMargin: "0px 0px -50px 0px" }); document.querySelectorAll(".floating-item, .fade-in-up, .animated-container").forEach(el => floatingObserver.observe(el)); }
        function handleNavigation(e) { const link = e.target.closest('a'); if (!link || link.target === '_blank' || link.protocol !== window.location.protocol || link.host !== window.location.host || e.metaKey || e.ctrlKey || e.shiftKey) { return; } const linkUrl = new URL(link.href); const isAnchorLink = !!linkUrl.hash; if (isAnchorLink && linkUrl.pathname === window.location.pathname) { e.preventDefault(); document.querySelector(linkUrl.hash)?.scrollIntoView({ behavior: 'smooth' }); return; } if (linkUrl.href === window.location.href) { e.preventDefault(); return; } e.preventDefault(); window.history.pushState({}, '', linkUrl.pathname + linkUrl.search + linkUrl.hash); route(); window.scrollTo(0, 0); };
        function initStaticEventListeners() { document.body.addEventListener('click', handleNavigation); window.addEventListener('popstate', route); window.addEventListener('resize', () => { document.querySelectorAll('.cross-fade-slider').forEach(slider => { const activeSlide = slider.querySelector('.item-card.active'); if (activeSlide) slider.style.height = `${activeSlide.offsetHeight}px`; }); }, { passive: true }); const menuToggle = document.querySelector('.menu-toggle'); const navOverlay = document.querySelector('.nav-overlay'); menuToggle.addEventListener('click', (e) => { e.stopPropagation(); document.body.classList.toggle('nav-is-open'); menuToggle.classList.toggle('is-active'); navOverlay.classList.toggle('is-active'); }); navOverlay.addEventListener('click', () => { document.body.classList.remove('nav-is-open'); menuToggle.classList.remove('is-active'); navOverlay.classList.remove('is-active'); }); const footer = document.getElementById('site-footer'); footer.innerHTML = `© 2025 Digital Craft. All rights reserved.`; footer.addEventListener('click', () => { window.location.href = '/admin.html'; }); }
        function applyCustomBackground(item = null) { const iframe = document.getElementById('custom-background-iframe'); if(!iframe) return; const customCode = item?.backgroundHtml || siteData.home?.backgroundHtml || ''; iframe.style.display = customCode.trim() !== "" ? 'block' : 'none'; iframe.srcdoc = customCode; }
        
        // --- ROUTER & INITIALIZATION ---
        function route() {
            const path = window.location.pathname;
            const detailPageRegex = /^\/(?:([a-z]{2})\/)?(services|portfolio|blog|contact)\/([a-zA-Z0-9-]+)\/?$/;
            const match = path.match(detailPageRegex);
            if (match) {
                const [, lang, collection, slug] = match;
                renderDetailPage(collection, slug, lang || defaultLang);
            } else {
                renderHomePage();
            }
        }

        async function initApp() {
            initStaticEventListeners();
            renderMenu();
            siteData = await loadData();
            if (siteData) {
                route(); // Render the initial page
            } else {
                mainContentEl.innerHTML = `<h1>Error: Could not load site data. Please check connection and try again.</h1>`;
            }
            document.getElementById('loader').classList.add('hidden'); 
        }

        initApp();
    </script>
    <script src="metrika.js" defer=""></script>
</body>
</html>